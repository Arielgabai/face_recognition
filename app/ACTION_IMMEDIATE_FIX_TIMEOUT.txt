â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘       FIX CRITIQUE : TIMEOUT REGISTER-WITH-EVENT-CODE          â•‘
â•‘                        3 Ã‰TAPES RAPIDES                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… PROBLÃˆME IDENTIFIÃ‰ ET CORRIGÃ‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Le matching dans /api/register-with-event-code Ã©tait SYNCHRONE.
â†’ Bloquait les workers pendant 30-60s
â†’ WORKER TIMEOUT avec 30 users simultanÃ©s

FIX : Migration vers ThreadPoolExecutor (ligne 5200 de main.py)


ğŸ“‹ Ã‰TAPE 1 : CONFIGURER LES VARIABLES (AWS CONSOLE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Ouvrez AWS App Runner Console :
   https://eu-west-3.console.aws.amazon.com/apprunner

2. Service : findme-prod-v7 â†’ Configuration â†’ Edit

3. Ajoutez cette NOUVELLE variable (CRITIQUE) :
   
   MATCHING_THREAD_POOL_SIZE = 10

4. VÃ©rifiez ces variables existantes :
   
   GUNICORN_WORKERS = 3
   BCRYPT_ROUNDS = 8
   DB_POOL_SIZE = 10
   DB_MAX_OVERFLOW = 20

5. Cliquez Save


ğŸš€ Ã‰TAPE 2 : DÃ‰PLOYER L'IMAGE v101
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PowerShell (Windows) :

cd face_recognition/app
.\deploy_fix_timeout.ps1

OU manuellement :

# Login ECR
aws ecr get-login-password --region eu-west-3 | docker login --username AWS --password-stdin 801541932532.dkr.ecr.eu-west-3.amazonaws.com

# Build
docker build -t findme-prod:v101 -f Dockerfile .

# Tag
docker tag findme-prod:v101 801541932532.dkr.ecr.eu-west-3.amazonaws.com/findme-prod:v101

# Push
docker push 801541932532.dkr.ecr.eu-west-3.amazonaws.com/findme-prod:v101

# Update App Runner
aws apprunner update-service --cli-input-json file://update-image.json --region eu-west-3

â³ Attendre 5-10 minutes (dÃ©ploiement)


ğŸ§ª Ã‰TAPE 3 : TESTER AVEC LOCUST (30 USERS)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

cd face_recognition/app
locust -f locust_file.py --host=https://votre-app.onrender.com

Naviguer : http://localhost:8089

ParamÃ¨tres :
- Nombre d'utilisateurs : 30
- Spawn rate : 5

Cliquez "Start swarming"


ğŸ“Š RÃ‰SULTATS ATTENDUS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

AVANT (v100)                      APRÃˆS (v101)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/api/register-with-event-code     /api/register-with-event-code
  - 11s latence mÃ©diane             - < 5s âœ…
  - Timeouts frÃ©quents              - 0% Ã©chec âœ…
  
/api/upload-selfie                /api/upload-selfie
  - 45s (20% fail)                  - < 10s (0% fail) âœ…

WORKER TIMEOUT (SIGKILL)          Aucun timeout âœ…


ğŸ” VÃ‰RIFICATION LOGS AWS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Logs App Runner doivent montrer :

âœ… [Init] ThreadPool matching initialisÃ© avec 10 workers
âœ… [RegisterEventCode] Matching scheduled in thread pool for user_id=XXX
âœ… [MATCH-SELFIE] START user_id=XXX event_id=YYY

âŒ PAS DE "WORKER TIMEOUT"
âŒ PAS DE "Worker was sent code 134"


ğŸ“– DOCUMENTATION DÃ‰TAILLÃ‰E
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Voir fichiers :
- FIX_FINAL_REGISTER_TIMEOUT.md    (diagnostic complet)
- DEPLOY_MAINTENANT_V101.md        (guide dÃ©ploiement)
- CONFIG_PRODUCTION_30_USERS.txt   (variables env)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Date : 19/01/2026
Status : âœ… PRÃŠT POUR DÃ‰PLOIEMENT

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
